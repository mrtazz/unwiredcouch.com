<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="cache-control" content="no-cache"/>
    <meta http-equiv="pragma" content="no-cache"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    



<link   rel="stylesheet"
        href="../../css/style.min.d007196be0a488024a8ff3950c1d24d7cc642808b82bcd9db9c486384e1434d3.css"
        integrity="sha256-0AcZa&#43;CkiAJKj/OVDB0k18xkKAi4K82ducSGOE4UNNM="
        type="text/css"
        media="screen">

<link   rel="stylesheet"
        href="../../css/mobile.min.9d1271f82d33327493aaf7c1818ceac101a822559d694bd14a222d686e28c391.css"
        integrity="sha256-nRJx&#43;C0zMnSTqvfBgYzqwQGoIlWdaUvRSiItaG4ow5E="
        type="text/css"
        media="handheld, only screen and (max-device-width: 960px)">

    <link href="https://unwiredcouch.com/atom.xml" type="application/atom+xml" rel="alternate" title="unwiredcouch.com: All Posts" />
    
    

    <title>Maglev: Fast Software Load Balancer on unwiredcouch.com</title>
    
    
    

  </head>
  <body>
    <div class="mainwrapper">

    <header class="header">
  <a class="gravatar hidemobile" href="../../">
    <img
      src="../../images/gravatar.jpg"
      height="50" width="50" class="avatar" alt="gravatar image" />
  </a>
  <nav class="menu">
    <ul>
      <li><a href="../../posts">Writing</a></li>
      <li><a href="../../reading">Reading</a></li>
      <li><a href="../../art">Art</a></li>
      <li><a href="../../setup">Setup</a></li>
      <li><a href="../../about.html">About</a></li>
      <li><a rel="me" href="https://chaos.social/@mrtazz">Mastodon</a></li>
    </ul>
  </nav>
</header>


    <main>
    
















<div class="reading-single">
  <div class="reading-header">
    <div class="reading-header-text">
      <ul class="reading-header-text-list">
        <li class="reading-header-text-list-item reading-single-book-title"> Maglev: Fast Software Load Balancer ðŸ“„ </li>
        <li class="reading-header-text-list-item"> by <span class="reading-single-book-author"> Danielle E. Eisenbud, Cheng Yi, Carlo Contavalli, Cody Smith, Ardas Cilingiroglu, Bin Cheyney, Wentao Shang, Jinnah Dylan Hosein, Roman Kononov, Eric Mann-Hielscher </span> </li>
        <li class="reading-header-text-list-item reading-single-publication-date"> Publication date: 2016</li>
        <li class="reading-header-text-list-item reading-single-book-date"> Read: May 29, 2018 </li>
        <li class="reading-header-text-list-item reading-single-origin-link"> <a href="https://research.google/pubs/maglev-a-fast-and-reliable-software-network-load-balancer/"> Link </a></li>
    </div>

    <img class="reading-single-cover-image" src="../../images/reading/maglev/cover.jpg" alt="Maglev: Fast Software Load Balancer book cover">
  </div>

  <ul>
<li>Google&rsquo;s network load balancer</li>
<li>distributed system on commodity servers</li>
<li>no physical deployment</li>
<li>horizontally scalable</li>
<li>load distribution via ECMP by network routers</li>
<li>consistent hashing and connection tracking</li>
<li>serving Google since 2008</li>
<li>Downside of hardware LB
<ul>
<li>limited vertical scale</li>
<li>only 1+1 redundancy</li>
<li>lack of flexibility + programmability</li>
<li>expensive to upgrade</li>
</ul>
</li>
</ul>
<p><img src="../../images/reading/maglev/sketch.png" alt="maglev architecture overview"></p>
<ul>
<li>larger clusters have hardware encapsulators between maglev and router so they don&rsquo;t need to be in the same L2 domain</li>
<li>Linux kernel is circumvented for fast packet processing</li>
<li>steering module consistent hashes between rx queues with packet rewrites threads</li>
<li>rewrites checks for VIP match, connection table</li>
<li>5 tuple host over round robin for stability of connections (rr is fallback)</li>
<li>813 kpps for 1500 bytes IP packets</li>
<li>processing speed of 9.06 Mpps for smaller packets</li>
</ul>
<h2 id="fast-packet-processing">Fast Packet Processing</h2>
<ul>
<li>userspace app circumventing kernel</li>
<li>shared packet pool with NIC</li>
<li>ring queue of pointers pointing to packets in pool</li>
<li>NIC and forwarder advance pointers in ring (no copying)</li>
<li>backend selection consistency across Maglev machines is accomplished by consistent hashing based on backend names (<strong>simplified algorithm!!</strong>)</li>
<li>kernel bypass 5x performance</li>
<li>handling fragments via special backend pool containing all Maglevs</li>
<li>special packet tracer packets that trigger Maglev to send debug info to SRC</li>
<li>steering module bottleneck before moving to 40Gbps</li>
<li>5 packet threads saturate 10Gbps NIC</li>
</ul>
<h2 id="questions">Questions</h2>
<ul>
<li><input disabled="" type="checkbox"> read up on ECMP</li>
<li><input disabled="" type="checkbox"> study Maglev hashing details</li>
</ul>


</div>


    </main>

    <footer class="footer">
    <ul class="menu-footer">
      <li><a href="../../imprint.html">Imprint</a></li>
    </ul>
</footer>


    </div>
  </body>
</html>
